<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>WFP Response</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- Datatables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>


    <!-- For Bootstrap Select -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>


    <!-- Icons -->
    <script src="https://kit.fontawesome.com/f3135b3376.js" crossorigin="anonymous"></script>

    <!-- Own Style Sheet -->
    <link href="styles.css" rel="stylesheet" />

</head>


<body>


    <div class="filters">
        <div class="title">
            <span>How is WFP responding to the Global Food Crisis?<br><br>
            </span>

        </div>
        <ul class="countryList">
            <li class="links" id="AFGlink">&nbsp;AFG&nbsp;</li>
            <li class="links" id="BGDlink">&nbsp;Bangladesh&nbsp;</li>
            <li class="links" id="BTNlink">&nbsp;Bhutan&nbsp;</li>
            <li class="links" id="KHMlink">&nbsp;Cambodia&nbsp;</li>
            <li class="links" id="PRKlink">&nbsp;DPR Korea&nbsp;</li>
            <li class="links" id="INDlink">&nbsp;India&nbsp;</li>
            <li class="links" id="IDNlink">&nbsp;Indonesia&nbsp;</li>
            <li class="links" id="KGZlink">&nbsp;Kyrgyz Republic&nbsp;</li>
            <li class="links" id="LAOlink">&nbsp;LAO&nbsp;</li>
            <li class="links" id="MMRlink">&nbsp;Myanmar&nbsp;</li>
            <li class="links" id="FJIlink">&nbsp;Pacific&nbsp;</li>
            <li class="links" id="PAKlink">&nbsp;Pakistan&nbsp;</li>
            <li class="links" id="PHLlink">&nbsp;Philippines&nbsp;</li>
            <li class="links" id="LKAlink">&nbsp;Sri Lanka&nbsp;</li>
            <li class="links" id="TJKlink">&nbsp;Tajikistan&nbsp;</li>
            <li class="links" id="TLSlink">&nbsp;Timor-Leste&nbsp;</li>
        </ul>
    </div>


    <div class="narrative">
        <p id="narrativeText"></p>
    </div>



    <script>
        // Pull in the Data Tables via jQuery

        const api_url = 'https://raw.githubusercontent.com/ctedja/regional_food_crisis_dashboard/main/data/summaries.json';

        async function populate() {
            const response = await fetch(api_url);
            const summariesData = await response.json();

            function buildNarrative(data) {
                var narrative = document.getElementById('narrativeText')
                narrative.innerHTML = data.map(function (row) {
                    let [id, countryName, fsnNarrative, wfpNarrative, stakeholderNarrative, marketAssessment, marketLink, fng, fngLink, mvamFoodSecurity, mvamFoodSecurityLink, primaryHighlight, primaryHighlightLink, secondaryHighlight, secondaryHighlightLink, upcoming, overallVulnerability, centerLng, centerLat, zoom
                    ] = row;
                    return `
                    <section id="${id}" class="section">
                    <span class="narrativeTitle">${countryName}<br></span>
                    <span class="narrativeText">${wfpNarrative}<br><br><br></span><hr><br>
                    </section>`;
                }).join('');

            }

            function goToByScroll(id) {
                // Remove "link" from the ID
                id = id.replace("link", "");
                // Scroll
                $('html, body').animate({
                    scrollTop: $("#" + id).offset().top - 130
                },
                    200, 'swing');
            }

            // $(".countryList > ul > li > a").click(function (e) {
            //     // Prevent a page reload when a link is pressed
            //     e.preventDefault();
            //     // Call the scroll function
            //     goToByScroll($(this).attr("id"));
            // });

            var links = document.getElementsByClassName('links')
            let clickedItem = ''

            const sections = document.querySelectorAll("section");


            // Create an array for these items, then make it so that we're listening for a click from each of these country names, and returning the function below
            Array.from(links).forEach(function (link) {
                $(link).click(function (e) {
                    e.preventDefault();
                    // Call the scroll function
                    goToByScroll(link.id);
                })
            })


            window.addEventListener("scroll", () => {
                let current = "";
                sections.forEach((section) => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (pageYOffset >= sectionTop - sectionHeight / 3) {
                        current = section.getAttribute("id");
                    }
                });

                console.log("this is current " + current)

                Array.from(links).forEach((li) => {
                    li.classList.remove("active");
                    if (li.classList.contains(current)) {
                        li.classList.add("active");
                    }
                });
            });


            buildNarrative(summariesData)

        }

        populate();

    </script>
</body>

</html>