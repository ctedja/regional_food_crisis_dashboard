<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>RBB Food Crisis Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js"></script>
    <script src="https://kit.fontawesome.com/f3135b3376.js" crossorigin="anonymous"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <!-- Datatables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>


    <script>
        $(document).ready(function () {
            $('a[data-bs-toggle="tab"]').on("shown.bs.tab", function (e) {
                var activeTab = $(e.target).text(); // Get the name of active tab
                var previousTab = $(e.relatedTarget).text(); // Get the name of previous active tab
                $(".active-tab span").html(activeTab);
                $(".previous-tab span").html(previousTab);
            });
        });
    </script>
</head>

<body>

    <div class="m-4">
        <img id="logo" src="logo.png">
        <div style="
        display:inline-block;">
            <header>The Impact of the Global Food Crisis</header>
            <p id="subheader">AN OVERVIEW OF INDIVIDUAL COUNTRY-LEVEL IMPACTS</p>
        </div>
        <ul id="myTab" class="nav nav-tabs">
            <li class="nav-item">
                <a href="#mapTab" class="nav-link active mapTabButton" data-bs-toggle="tab">MAP</a>
            </li>
            <li class="nav-item">
                <a href="#tableTab" class="nav-link tableTabButton" data-bs-toggle="tab">TABLE</a>
            </li>
        </ul>

        <div class="tab-content">
            <br>

            <!-- Map Tab -->
            <div class="tab-pane fade show active" id="mapTab">

                <div class="sidebar">
                    <div class="select">
                        <p class="indicatorName">&nbsp;&#xf002;&nbsp;&nbsp;Search by Country and/or Indicator</p>
                        <select id="countrySelector" class="form-select selectpicker" data-width="100%" data-size="8"
                            name="country" data-dropdown>
                            <option value="">SELECT COUNTRY</option>
                            <option id="afg" value="AFG">Afghanistan</option>
                            <option value="BGD">Bangladesh</option>
                            <option value="BTN">Bhutan</option>
                            <option value="KHM">Cambodia</option>
                            <option value="PRK">DPRK</option>
                            <option value="IND">India</option>
                            <option value="IDN">Indonesia</option>
                            <option value="KGZ">Kyrgyz Republic</option>
                            <option value="LAO">Laos</option>
                            <option value="MMR">Myanmar</option>
                            <option value="NPL">Nepal</option>
                            <option value="FJI">Pacific</option>
                            <option value="PAK">Pakistan</option>
                            <option value="PHL">Philippines</option>
                            <option value="LKA">Sri Lanka</option>
                            <option value="TJK">Tajikistan</option>
                            <option value="TLS">Timor-Leste</option>
                        </select>
                    </div>
                    <div class="select">
                        <select id="indicatorSelector" class="form-select selectpicker" data-width="100%" data-size="8"
                            name="country" data-dropdown>
                            <option value="">SELECT INDICATOR</option>
                            <option selected value="Overall Vulnerability">Overall Vulnerability</option>
                            <option value="Underlying Food Insecurity">Underlying Food Insecurity</option>
                            <option value="Inflation (%)">Inflation (%)</option>
                            <option value="Food Inflation (%)">Food Inflation (%)</option>
                            <option value="Currency Exchange (YoY, %)">Currency Exchange (YoY)</option>
                            <!-- <option value="Dependency on Russia or Ukraine">Dependency on Russia or Ukraine
                            </option>
                            <option value="Cereal Import Dependency">Cereal Import Dependency</option>
                            <option value="Fertilizer Consumption">Fertilizer Consumption</option>
                            <option value="GDP">GDP</option> -->
                        </select>
                    </div>
                </div>
                <div id="narrativeBox">
                    <div id="narrativeTitle">Select Country</div>
                    <div id="narrativeIndicator"></div>
                    <div id="narrativeText">The global food crisis is impacting each individual country differently.<br><br>
                        There are four countries of highest concern (Afghanistan, Myanmar, Pakistan and Sri Lanka) and
                        four countries marked as countries for close monitoring (Bangladesh, Laos, Kyrgyz Republic,
                        Tajikistan).
                        <br><br>
                        WFP is continuing to monitor the situation and respond accordingly. Select a country or use the
                        filter to learn more.
                    </div>
                </div>
                <div id="map" class="map"></div>
                <div id="legend"></div>
                <div id="research"></div>
            </div>


            <!-- Table Tab -->
            <div class="tab-pane fade" id="tableTab">


                <span style="font-size:16px;color:#007dbc;font-weight:400;">&nbsp;&nbsp;Sort: </span>&nbsp;&nbsp;
                <div class="btn-group" data-toggle="buttons" role="group" aria-label="Basic radio toggle button group">
                    <input type="radio" class="btn-check" name="btnradio" id="btnradio0" autocomplete="off" checked>
                    <label class="btn btn-outline-primary btn-sm" id="sortVulnerability" for="btnradio0">Overall
                        Vulnerability</label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">
                    <label class="btn btn-outline-primary btn-sm" id="sortFoodSecurity" for="btnradio1">Underlying Food
                        Security</label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
                    <label class="btn btn-outline-primary btn-sm" id="sortInflation" for="btnradio2">Inflation</label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">
                    <label class="btn btn-outline-primary btn-sm" id="sortFoodInflation" for="btnradio3">Food
                        Inflation</label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnradio4" autocomplete="off">
                    <label class="btn btn-outline-primary btn-sm" id="sortCurrency" for="btnradio4">Currency</label>


                </div>
                <br><br>

                <div id="tableWrapper" style="width:100%">
                    <table class="display" style="width:100%" id="mydatatable">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Overall Vulnerability</th>
                                <th>Underlying Food Insecurity</th>
                                <th>Inflation (%)</th>
                                <th>Food Inflation (%)</th>
                                <th>Currency Exchange (%)</th>
                                <th>Russia/Ukraine Dependency</th>
                                <th>Cereal Import Dependency (%)</th>
                                <th>Fertilizer Consumption</th>
                                <th>Debt Distress</th>
                                <th>GDP</th>
                            </tr>
                        </thead>
                        <tbody id="myTable">
                        </tbody>
                    </table>
                </div>
                <div><span style="text-align:right;font-size:12px;color:#767676;">Data are the latest available (as of
                        early
                        October), but months may not be consistent. Learn more <a
                            href="https://docs.wfp.org/api/documents/WFP-0000142386/download/"
                            target="_blank">here</a>.</span>
                </div>
            </div>
        </div>
    </div>









    <script>
        // Data
        const url_1 = 'https://raw.githubusercontent.com/ctedja/regional_food_crisis_dashboard/main/data/main.json';
        const url_2 = 'https://raw.githubusercontent.com/ctedja/regional_food_crisis_dashboard/main/data/indicators.json';

        async function populate() {
            const response = await fetch(url_1);
            const countryData = await response.json();

            const response2 = await fetch(url_2);
            const indicatorData = await response2.json();


            console.log(countryData)
            // Proceed
            const countrySelector = document.getElementById('countrySelector')
            const indicatorSelector = document.getElementById('indicatorSelector')
            let clickedItem = ''

            // Use the selectors to filter and fly
            countrySelector.addEventListener('change', function (e) {
                const match = countryData.filter(countryArr => countryArr[0] === this.value);
                console.log('You clicked a row containing the country of ' + this.value)
                console.log('You clicked a match for the country of ' + match[1][0])
                document.getElementById("narrativeTitle").innerHTML = match[1][1];
                // document.getElementById("narrativeText").innerHTML = match[1][2];
                displayNarrative(match[1][2]);
                displayResearch(match[1][1], match[1][5], match[1][6], match[1][7], match[1][8], match[1][9], match[1][10], match[1][11], match[1][12], match[1][13], match[1][14], match[1][15]);
                displayChloroSingle(match[1][0])
                // Each argument corresponds to: displayResearch(marketAssessment, marketLink, fng, fngLink, mvamFoodSecurity, mvamFoodSecurityLink, primaryHighlight, primaryHighlightLink, secondaryHighlight, secondaryHighlightLink, upcoming)

                map.flyTo({
                    center: [match[1][17], match[1][18]],
                    zoom: match[1][19],
                    speed: 0.4,
                    curve: 2
                })
            });

            indicatorSelector.addEventListener('change', function (e) {
                const match = countryData.filter(countryArr => countryArr[20] === this.value);
                console.log('You clicked a row containing the indicator of ' + this.value)
                displayChloro(match);
                displayChloroSingle(match);

            });

            // Load the map
            mapboxgl.accessToken = 'pk.eyJ1IjoiY3RlZGphIiwiYSI6ImNraWk4OGd6aTA0dGQyeW1pbWF2Mm5qbTUifQ.H7qbJAdh988Vg7mq8Muvjw';
            const map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/ctedja/ckxf77dtjg8nx15o5bn7st070',
                center: [105, 20],
                zoom: 2.25
            });


            map.on('load', function () {
                map.addSource('cbs', {  // country-boundaries-simplified
                    'type': 'geojson',
                    'data': 'https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_admin_0_countries.geojson',
                    'generateId': true
                });
                // Create a default layer
                const defaultLayer = countryData.filter(countryArr => countryArr[20] === 'Overall Vulnerability')
                displayChloro(defaultLayer)
            });


            let hoveredStateId = null;

            // FUNCTIONS
            // Create the function to change the research box 
            function displayResearch(countryName, marketAssessment, marketLink, fng, fngLink, mvamFoodSecurity, mvamFoodSecurityLink, primaryHighlight, primaryHighlightLink, secondaryHighlight, secondaryHighlightLink, upcoming) {
                // marketAssessment, marketLink, fng, fngLink, primaryHighlight, primaryHighlightLink, secondaryHighlight, secondaryHighlightLink, upcoming
                let mvamText;
                if (mvamFoodSecurity == null) {
                    mvamText = "";
                } else {
                    mvamText = "<i class='fas fa-wifi' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>mVAM Food Survey (" + mvamFoodSecurity + ")</span><br>" +
                        "LATEST  |  <a href='" + mvamFoodSecurityLink + "' target='_blank'>LINK</a><br><br>"
                };

                let primaryText;
                if (primaryHighlight == null) {
                    primaryText = "";
                } else {
                    primaryText = "<i class='fa-solid fa-magnifying-glass-chart' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>" + primaryHighlight + "</span><br>" +
                        "LATEST  |  <a href='" + primaryHighlightLink + "' target='_blank'>LINK</a><br><br>"
                };

                let secondaryText;
                if (secondaryHighlight == null) {
                    secondaryText = "";
                } else {
                    secondaryText = "<i class='fa-solid fa-newspaper' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>" + secondaryHighlight + "</span><br>" +
                        "LATEST  |  <a href='" + secondaryHighlightLink + "' target='_blank'>LINK</a><br><br>"
                };

                let marketText;
                if (marketAssessment == null) {
                    marketText = "";
                } else {
                    marketText = "<i class='fa-solid fa-shop' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>MARKET MONITOR</span><br>" +
                        marketAssessment + "  |  <a href='" + marketLink + "' target='_blank'>LINK</a><br><br>"
                };

                let fngText;
                if (fng == null) {
                    fngText = "";
                } else {
                    fngText = "<i class='fa-solid fa-bowl-food' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>FILL THE NUTRIENT GAP</span><br>" +
                        fng + "  |  <a href='" + fngLink + "' target='_blank'>LINK</a><br><br>"
                };

                let upcomingText;
                if (upcoming == null) {
                    upcomingText = "";
                } else {
                    upcomingText = "<hr><br><i class='fas fa-step-forward' style='font-size:14px'></i><br>" +
                        "<span style='font-weight:700'>UPCOMING</span><br>" +
                        upcoming
                };

                document.getElementById("research").innerHTML =
                    "<span style='font-size:12px;color:#007dbc;font-weight:700'>Evidence: " + countryName + "</span>" + "<br>" + "<br>" +
                    // primaryText + secondaryText + 
                    mvamText + primaryText + marketText + fngText + secondaryText + upcomingText
                //  + fngText + upcomingText
            }


            // Function to display narrative
            function displayNarrative(fsnNarrative
                // , wfpNarrative, stakeholderNarrative
            ) {
                let fsnText;
                if (fsnNarrative == "") {
                    fsnText = "";
                } else {
                    fsnText =
                        // "<span style='font-weight:700'>Food Security and Nutrition Implications: </span>" +
                        fsnNarrative
                    // + "<br><br>"
                };

                document.getElementById("narrativeText").innerHTML = fsnText
                //  + wfpText + stakeholderText
            }


            // Create the function to change text in the form-select
            function changeText(indicator) {
                document.getElementById("countrySelector").value = indicator;;
            }

            // Create the map display function. Use the 'for' to add the value for each individual country.
            function displayChloro(filteredRows) {

                for (let i = 0; i < filteredRows.length; i++) {

                    // Remove the layer if it exists, so that each time it can refresh anew.
                    if (map.getLayer("countryFill" + [i])) {
                        map.removeLayer("countryFill" + [i]);
                    }

                    if (map.getLayer("countryBorder" + [i])) {
                        map.removeLayer("countryBorder" + [i]);
                    }

                    if (map.getLayer("hoverFill" + [i])) {
                        map.removeLayer("hoverFill" + [i]);
                    }


                    let addColor;
                    if (filteredRows[i][22] == 1) {
                        addColor = "#2c575a";
                    } else if (filteredRows[i][22] == 2) {
                        addColor = "#58adb3";
                    } else if (filteredRows[i][22] == 3) {
                        addColor = "#acd6d9";
                    } else {
                        addColor = "#bbbbbb"
                    };

                    let filteredCountry = filteredRows[i][0]

                    // Fader
                    setTimeout(function () {
                        map.setPaintProperty("countryFill" + [i], "fill-opacity", 0.7);
                    },
                        0
                    );

                    // country-fills
                    map.addLayer({
                        "id": "countryFill" + [i],
                        "type": "fill",
                        "source": "cbs",
                        "layout": {},
                        "paint": {
                            "fill-color": addColor,
                            "fill-opacity": .25,
                            "fill-opacity-transition": { duration: 1000 }
                        },
                        "filter": ["==", "adm0_a3", filteredCountry]
                    })

                    // country borders
                    map.addLayer({
                        "id": "countryBorder" + [i],
                        "type": "line",
                        "source": "cbs",
                        "layout": {},
                        "paint": {
                            "line-color": 'white',
                            "line-width": .9
                        },
                        "filter": ["==", "adm0_a3", filteredCountry]
                    });



                    // Popups
                    const popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mouseenter', 'countryFill' + [i], (e) => {
                        // console.log('A mouseenter event occurred on ' + [i]);
                        map.getCanvas().style.cursor = 'pointer';

                        let popupValueText;
                        if (filteredRows[i][21] == null) {
                            popupValueText = "Value not available"
                        } else {
                            popupValueText = filteredRows[i][21]
                        }


                        popup.setLngLat({ lng: filteredRows[i][17], lat: filteredRows[i][18] })
                            .setHTML('<h3><span style="color:' + addColor + '";>' + filteredRows[i][1] + "</span></h3><br><h4>" +
                                '<i class="fas fa-circle" style="color:' + addColor + '";></i>&nbsp;&nbsp;'
                                + popupValueText + '</h4><h5>' + filteredRows[i][20] + '' + '</h5>')
                            .addTo(map);
                    });

                    map.on("mouseleave", "countryFill" + [i], () => {
                        popup.remove();
                        map.getCanvas().style.cursor = '';
                    });



                    // Hover effects
                    map.addLayer({
                        "id": "hoverFill" + [i],
                        "type": "fill",
                        "source": "cbs",
                        "layout": {},
                        "paint": {
                            "fill-color": addColor,
                            "fill-outline-color": "white",
                            "fill-opacity": [
                                'case',
                                ['boolean', ['feature-state', 'hover'], false],
                                1,
                                0
                            ]
                        },
                        "filter": ["==", "adm0_a3", filteredCountry]
                    });

                    map.on('mouseover', 'hoverFill' + [i], (e) => {
                        if (e.features.length > 0) {
                            if (hoveredStateId !== null) {
                                map.setFeatureState(
                                    { source: 'cbs', id: hoveredStateId },
                                    { hover: false }
                                );
                            }
                            hoveredStateId = e.features[0].id;
                            map.setFeatureState(
                                { source: 'cbs', id: hoveredStateId },
                                { hover: true }
                            );
                        }
                    });

                    map.on("mouseleave", "hoverFill" + [i], () => {
                        if (hoveredStateId !== null) {
                            map.setFeatureState(
                                { source: 'cbs', id: hoveredStateId },
                                { hover: false }
                            );
                        }
                        hoveredStateId = null;
                    });

                    // Event listeners for the map itself
                    map.on("click", "countryFill" + [i], () => {
                        flyFunction(i);
                        document.getElementById("narrativeTitle").innerHTML = filteredRows[i][1];
                        displayNarrative(filteredRows[i][2], filteredRows[i][3], filteredRows[i][4]);
                        changeText(filteredRows[i][0]);
                        displayChloroSingle(filteredRows[i][0]);
                        displayResearch(filteredRows[i][1], filteredRows[i][5], filteredRows[i][6], filteredRows[i][7], filteredRows[i][8], filteredRows[i][9], filteredRows[i][10], filteredRows[i][11], filteredRows[i][12], filteredRows[i][13])
                    });


                    function flyFunction() {
                        map.flyTo({
                            center: [filteredRows[i][17], filteredRows[i][18]],
                            zoom: filteredRows[i][19],
                            speed: 0.4,
                            curve: 2
                        })
                    };
                }



                // Create legend
                var filteredIndicator = filteredRows[1][20]
                console.log('you look for : ' + filteredIndicator)

                var layers;
                if (filteredIndicator == "Overall Vulnerability")
                    layers = ["Country of Concern",
                        "Country to Monitor",
                        "NA"];
                else if (filteredIndicator == "Underlying Food Insecurity" |
                    filteredIndicator == "GDP" |
                    filteredIndicator == "Debt Distress" |
                    filteredIndicator == "Fertilizer Consumption" |
                    filteredIndicator == "Cereal Import Dependency" |
                    filteredIndicator == "Dependency on Russia or Ukraine")
                    layers = ["High",
                        "Moderate",
                        "Low"];
                else if (filteredIndicator == "Currency Exchange (YoY, %)")
                    layers = ["< -25%",
                        "-25 to -15%",
                        "> -15%"];
                else {
                    layers = [">=30%",
                        "10-30%",
                        "<=10%"]
                }

                const colors = [
                    '#2c575a', '#58adb3', '#acd6d9'
                ];

                legend.innerHTML = "";
                legend.innerHTML = ("<span style='font-size:20px;color:#007dbc'>" + filteredIndicator + "<br><br>");

                layers.forEach((layer, i) => {
                    const color = colors[i];
                    const item = document.createElement('div');
                    const key = document.createElement('span');
                    key.className = 'legend-key';
                    key.style.backgroundColor = color;

                    const value = document.createElement('span');
                    value.innerHTML = `${layer}`;
                    item.appendChild(key);
                    item.appendChild(value);
                    legend.appendChild(item);
                });
            }






            function displayChloroSingle(filteredCountry) {


                // Remove the layer if it exists, so that each time it can refresh anew.

                if (map.getLayer("countryBorder")) {
                    map.removeLayer("countryBorder");
                }


                // let filteredCountry = filteredRows[i][0]

                // country borders
                map.addLayer({
                    "id": "countryBorder",
                    "type": "line",
                    "source": "cbs",
                    "layout": {},
                    "paint": {
                        "line-color": '#3b3b3b',
                        "line-width": 2
                    },
                    "filter": ["==", "adm0_a3", filteredCountry]
                });

            }



            // TABLE BUILDING
            function buildTable(data) {
                var table = document.getElementById('myTable')
                table.innerHTML = data.map(function (row) {
                    let [id, country, inflation, foodInflation, currencyExchange, russiaUkraineDependency, cerealImportDependency,
                        fertilizerConsumption, debtDistress, gdp, underlyingFoodInsecurity, overallVulnerability,
                        inflationHidden, foodInflationHidden, currencyExchangeHidden] = row;
                    return `<tr>
                <td>${country}</td>
                <td>${overallVulnerability}</td>
                <td>${underlyingFoodInsecurity}</td>
                <td>${inflation}</td>
                <td>${foodInflation}</td>
                <td>${currencyExchange}</td>
                <td>${russiaUkraineDependency}</td>
                <td>${cerealImportDependency}</td>
                <td>${fertilizerConsumption}</td>
                <td>${debtDistress}</td>
                <td>${gdp}</td>
                <td>${inflationHidden}</td>
                <td>${foodInflationHidden}</td>
                <td>${currencyExchangeHidden}</td>
                </tr>`;
                }).join('');
            }

            buildTable(indicatorData)


            $(document).ready(function () {
                var oTable = $('#mydatatable').DataTable({
                    rowCallback: function (row, data, index) {

                        // Format nulls
                        function removeNull(columnNumber) {
                            if (data[columnNumber] == 'null') {
                                $(row).find('td:eq(' + columnNumber + ')').text('Unavailable')
                                $(row).find('td:eq(' + columnNumber + ')').css('color', '#bbbbbb');
                            }
                        }

                        [2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(removeNull)


                        $(row).find('td:eq(1)').css('background-color', '#acd6d9');
                        if (data[1] == "Country of Concern") {
                            $(row).find('td:eq(1)').css('background-color', '#2c575a');
                            $(row).find('td:eq(1)').css('color', 'white');
                            $(row).find('td:eq(1)').css('font-weight', '700');
                        }
                        if (data[1] == "Country to Monitor") {
                            $(row).find('td:eq(1)').css('background-color', '#58adb3');
                            $(row).find('td:eq(1)').css('color', 'white');
                            $(row).find('td:eq(1)').css('font-weight', '600');
                        }


                        $("#sortVulnerability").on('click', function () {
                            $(row).find('td').css('background-color', 'white');
                            $(row).find('td').css('color', '#404040');
                            $(row).find('td').css('font-weight', '400');
                            [2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(removeNull)
                            $(row).find('td:eq(1)').css('background-color', '#acd6d9');
                            $(row).find('td:eq(6)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(7)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(8)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(9)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(10)').css('background-color', '#f1f1f1');
                            if (data[1] == "Country of Concern") {
                                $(row).find('td:eq(1)').css('background-color', '#2c575a');
                                $(row).find('td:eq(1)').css('color', 'white');
                                $(row).find('td:eq(1)').css('font-weight', '700');
                            }
                            if (data[1] == "Country to Monitor") {
                                $(row).find('td:eq(1)').css('background-color', '#58adb3');
                                $(row).find('td:eq(1)').css('color', 'white');
                                $(row).find('td:eq(1)').css('font-weight', '600');
                            }
                        });


                        $("#sortFoodSecurity").on('click', function () {
                            $(row).find('td').css('background-color', 'white');
                            $(row).find('td').css('color', '#404040');
                            $(row).find('td').css('font-weight', '400');
                            [2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(removeNull)
                            $(row).find('td:eq(2)').css('background-color', '#e4e4e4');
                            $(row).find('td:eq(6)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(7)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(8)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(9)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(10)').css('background-color', '#f1f1f1');
                            if (data[2] == "High") {
                                $(row).find('td:eq(2)').css('background-color', '#2c575a');
                                $(row).find('td:eq(2)').css('color', 'white');
                                $(row).find('td:eq(2)').css('font-weight', '700');
                            }
                            if (data[2] == "Moderate") {
                                $(row).find('td:eq(2)').css('background-color', '#58adb3');
                                $(row).find('td:eq(2)').css('color', 'white');
                                $(row).find('td:eq(2)').css('font-weight', '600');
                            }
                            if (data[2] == "Low") {
                                $(row).find('td:eq(2)').css('background-color', '#acd6d9');
                                $(row).find('td:eq(2)').css('color', 'white');
                                $(row).find('td:eq(2)').css('font-weight', '400');
                            }
                        })

                        function customValueSorter(numberColumn, tdeqColumn) {
                            $(row).find('td').css('background-color', 'white');
                            $(row).find('td').css('color', '#404040');
                            $(row).find('td').css('font-weight', '400');
                            [2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(removeNull)
                            $(row).find('td:eq(6)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(7)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(8)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(9)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(10)').css('background-color', '#f1f1f1');
                            $(row).find(tdeqColumn).css('background-color', '#e4e4e4');
                            if (data[numberColumn] >= 50) {
                                $(row).find(tdeqColumn).css('background-color', '#122324');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '700');
                            }
                            if (data[numberColumn] >= 40 && data[numberColumn] < 50) {
                                $(row).find(tdeqColumn).css('background-color', '#2c575a');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '600');
                            }
                            if (data[numberColumn] >= 30 && data[numberColumn] < 40) {
                                $(row).find(tdeqColumn).css('background-color', '#468a8f');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '400');
                            }
                            if (data[numberColumn] >= 20 && data[numberColumn] < 30) {
                                $(row).find(tdeqColumn).css('background-color', '#58adb3');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '400');
                            }
                            if (data[numberColumn] >= 10 && data[numberColumn] < 20) {
                                $(row).find(tdeqColumn).css('background-color', '#79bdc2');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '400');
                            }
                            if (data[numberColumn] >= 0 && data[numberColumn] < 10) {
                                $(row).find(tdeqColumn).css('background-color', '#8ac6ca');
                                $(row).find(tdeqColumn).css('color', 'white');
                                $(row).find(tdeqColumn).css('font-weight', '400');
                            }
                        }

                        $("#sortInflation").on('click', function () {
                            customValueSorter(3, 'td:eq(3)')
                        })

                        $("#sortFoodInflation").on('click', function () {
                            customValueSorter(4, 'td:eq(4)')
                        })

                        $("#sortCurrency").on('click', function () {
                            $(row).find('td').css('background-color', 'white');
                            $(row).find('td').css('color', '#404040');
                            $(row).find('td').css('font-weight', '400');
                            [2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(removeNull)
                            $(row).find('td:eq(5)').css('background-color', '#e4e4e4');
                            $(row).find('td:eq(6)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(7)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(8)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(9)').css('background-color', '#f1f1f1');
                            $(row).find('td:eq(10)').css('background-color', '#f1f1f1');
                            if (data[5] <= -50) {
                                $(row).find('td:eq(5)').css('background-color', '#122324');
                                $(row).find('td:eq(5)').css('color', 'white');
                                $(row).find('td:eq(5)').css('font-weight', '700');
                            }
                            if (data[5] <= -40 && data[5] > -50) {
                                $(row).find('td:eq(5)').css('background-color', '#2c575a');
                                $(row).find('td:eq(5)').css('color', 'white');
                                $(row).find('td:eq(5)').css('font-weight', '600');
                            }
                            if (data[5] <= -30 && data[5] > -40) {
                                $(row).find('td:eq(5)').css('background-color', '#468a8f');
                                $(row).find('td:eq(5)').css('color', 'white');
                                $(row).find('td:eq(5)').css('font-weight', '400');
                            }
                            if (data[5] <= -20 && data[5] > -30) {
                                $(row).find('td:eq(5)').css('background-color', '#58adb3');
                                $(row).find('td:eq(5)').css('color', 'white');
                                $(row).find('td:eq(5)').css('font-weight', '400');
                            }
                            if (data[5] < 0 && data[5] > -20) {
                                $(row).find('td:eq(5)').css('background-color', '#79bdc2');
                                $(row).find('td:eq(5)').css('color', 'white');
                                $(row).find('td:eq(5)').css('font-weight', '400');
                            }
                            if (data[5] > 0) {
                                $(row).find('td:eq(5)').css('background-color', 'white');
                                $(row).find('td:eq(5)').css('color', '404040');
                                $(row).find('td:eq(5)').css('font-weight', '400');
                            }
                        })
                        $(row).find('td:eq(6)').css('background-color', '#f1f1f1');
                        $(row).find('td:eq(7)').css('background-color', '#f1f1f1');
                        $(row).find('td:eq(8)').css('background-color', '#f1f1f1');
                        $(row).find('td:eq(9)').css('background-color', '#f1f1f1');
                        $(row).find('td:eq(10)').css('background-color', '#f1f1f1');
                    },
                    order: [[0, 'asc']],
                    stripeClasses: [],
                    info: false,
                    paging: false,
                    searching: false,
                    // order: [[1, 'desc']],
                    columnDefs: [{
                        targets: [3, 4, 5],
                        className: 'dt-body-right',
                        type: 'html-num'
                    },
                    {
                        targets: [11, 12, 13],
                        visible: false,
                        searchable: true,
                    },
                    // {
                    //     targets: [8, 9, 10],
                    //     className: 'dt-head-right',
                    // },
                    {
                        targets: [1],
                        type: "customSortVulnerability"
                    },
                    {
                        targets: [2],
                        type: "customSortFoodSecurity"
                    }
                    ],
                    aoColumns: [
                        // null,
                        // { orderSequence: ['asc'] },
                        // { orderSequence: ['desc', 'asc', 'asc'] },
                        // { orderSequence: ['desc'] }
                    ],

                });

                // Start with the vulnerability column sorted
                // Sort the strings in a custom order, otherwise it goes alphabetical
                $.fn.dataTable.ext.type.order['customSortVulnerability-pre'] = function (d) {
                    switch (d) {
                        case 'Lower Vulnerability': return 3;
                        case 'Country to Monitor': return 2;
                        case 'Country of Concern': return 1;
                    }
                    return 0;
                };

                // Sort the strings in a custom order, otherwise it goes alphabetical
                $.fn.dataTable.ext.type.order['customSortFoodSecurity-pre'] = function (d) {
                    switch (d) {
                        case 'Low': return 1;
                        case 'Moderate': return 2;
                        case 'High': return 3;
                    }
                    return 0;
                };

                // Sorter
                $("#sortVulnerability").on('click', function () {
                    oTable.order(1, 'asc').draw();
                });
                $("#sortFoodSecurity").on('click', function () {
                    oTable.order(2).draw();
                });
                $("#sortInflation").on('click', function () {
                    oTable.order(11).draw();
                });
                $("#sortFoodInflation").on('click', function () {
                    oTable.order(12).draw();
                });
                $("#sortCurrency").on('click', function () {
                    oTable.order(13, 'asc').draw();
                });

                oTable.order(1, 'asc').draw();
            });
        }
        populate();

    </script>
</body>

</html>